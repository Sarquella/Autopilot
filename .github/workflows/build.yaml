name: ⚙️ Build

on:
  push:
    branches: ["main"]

jobs:
  build:
    name: Build
    runs-on: macos-13

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: 🔨 Xcode version
        run: |
          xcodebuild -version
      - name: 📦 SPM Cache
        uses: actions/cache@v3
        with:
          path: .spm-cache
          key: ${{ runner.os }}-spm-${{ hashFiles('**/Package.resolved') }}
          restore-keys: |
            ${{ runner.os }}-spm-
      - name: ⚙️ Build
        run: |
          xcodebuild build \
          -scheme Autopilot \
          -clonedSourcePackagesDirPath '.spm-cache' \
          -disableAutomaticPackageResolution \
          -onlyUsePackageVersionsFromResolvedFile \
          -skipPackageUpdates \
          -destination 'platform=macOS,name=Any Mac'
